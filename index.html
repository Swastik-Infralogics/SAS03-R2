<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Meta and title -->
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>SAS03-NHAI Standalone Project Information</title>
  <link rel="icon" href="Swastik S.png" type="image/x-icon">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    /* Existing styles remain unchanged */
    /* ... [Your existing CSS styles] ... */
  </style>
</head>
<body>

  <!-- Progress Bar -->
  <div id="progress-bar">
    <div class="progress-bar-spinner"></div>
    <p>Loading Images...</p>
  </div>

  <!-- Background Video -->
  <video autoplay muted loop id="bg-video">
    <source src="Animated Video.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <!-- Home Button -->
  <a href="https://swastik-infralogics.github.io/SAS03/" class="home-button">Home</a>

  <!-- Main Container -->
  <div class="main-container">

    <!-- Gallery Section -->
    <div class="gallery-section">
      <h1>Image Gallery - NHAI Project - SAS03</h1>
      <div class="inner-containers" id="gallery">
        <!-- Dynamically loaded images from GCS will appear here -->
      </div>
    </div>

    <!-- Preview Section -->
    <div class="preview-section">
      <img id="preview-image" src="" alt="">
    </div>

  </div>

  <!-- Logo -->
  <img src="Swastik S.png" alt="Swastik Logo" class="logo">

  <!-- JavaScript to Load and Sort Images from GCS Bucket -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      listImages();
    });

    async function listImages() {
      const bucketName = 'swastik_bucket-1'; // Replace with your GCS bucket name
      const folderName = 'SAS03/'; // Replace with your folder name, include trailing slash if needed
      // Modify the fields parameter to include 'updated' for each item
      const apiUrl = `https://storage.googleapis.com/storage/v1/b/${bucketName}/o?prefix=${encodeURIComponent(folderName)}&fields=items(name,updated)&delimiter=/`;

      // Show the progress bar
      document.getElementById('progress-bar').style.display = 'flex';

      try {
        const response = await fetch(apiUrl);
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }

        const data = await response.json();
        const items = data.items || [];
        const gallery = document.getElementById('gallery');

        // Filter image files based on file extensions
        const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
        const images = items.filter((item) => {
          const extension = item.name.split('.').pop().toLowerCase();
          return imageExtensions.includes(extension);
        });

        // Sort images by 'updated' timestamp in descending order (newest first)
        images.sort((a, b) => new Date(b.updated) - new Date(a.updated));

        // Clear any existing images in the gallery
        gallery.innerHTML = '';

        // Iterate over the sorted images and append them to the gallery
        images.forEach((item) => {
          const imageName = item.name;
          const imageUrl = `https://storage.googleapis.com/${bucketName}/${encodeURIComponent(imageName)}`;

          // Create gallery item
          const imgDiv = document.createElement('div');
          imgDiv.classList.add('inner-container');

          // Use the same image as thumbnail (or adjust if you have separate thumbnails)
          const thumbnailUrl = imageUrl;

          imgDiv.style.backgroundImage = `url(${thumbnailUrl})`;
          imgDiv.setAttribute('data-image', imageUrl);
          imgDiv.title = imageName;
          gallery.appendChild(imgDiv);

          // Add click event to display the preview image
          imgDiv.addEventListener('click', function () {
            const previewImage = document.getElementById('preview-image');
            previewImage.src = imageUrl;
            previewImage.alt = imageName;
          });
        });

      } catch (error) {
        console.error('Error fetching image list:', error);
        alert('Failed to load images. Please try again later.');
      } finally {
        // Hide the progress bar after processing
        document.getElementById('progress-bar').style.display = 'none';
      }
    }
  </script>

</body>
</html>
