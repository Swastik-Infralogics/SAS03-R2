<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Google Drive API Test</title>
</head>
<body>
    <button id="signin-button">Sign In</button>
    <button id="signout-button">Sign Out</button>
    <div id="content"></div>

    <!-- Load the API client and auth2 library -->
    <script async defer src="https://apis.google.com/js/api.js" onload="handleClientLoad()"></script>

    <script>
        const clientId = '762399051300-ok3rcfci2904o2t87qip11evkce89dhb.apps.googleusercontent.com';
        const apiKey = 'AIzaSyAfExdKOvGvadFP4x6Wxcx06cGR2UJliaY';
        const scopes = 'https://www.googleapis.com/auth/drive.readonly';
        const discoveryDocs = ["https://www.googleapis.com/discovery/v1/apis/drive/v3/rest"];

        function handleClientLoad() {
            gapi.load('client:auth2', initClient);
        }

        function initClient() {
            gapi.client.init({
                apiKey: apiKey,
                clientId: clientId,
                discoveryDocs: discoveryDocs,
                scope: scopes
            }).then(function () {
                // Listen for sign-in state changes.
                gapi.auth2.getAuthInstance().isSignedIn.listen(updateSigninStatus);

                // Handle the initial sign-in state.
                updateSigninStatus(gapi.auth2.getAuthInstance().isSignedIn.get());

                document.getElementById('signin-button').onclick = handleSignInClick;
                document.getElementById('signout-button').onclick = handleSignOutClick;
            }, function(error) {
                console.error('Error initializing Google API client', error);
            });
        }

        function updateSigninStatus(isSignedIn) {
            if (isSignedIn) {
                listFiles();
            } else {
                document.getElementById('content').innerHTML = 'Please sign in to view files.';
            }
        }

        function handleSignInClick(event) {
            gapi.auth2.getAuthInstance().signIn();
        }

        function handleSignOutClick(event) {
            gapi.auth2.getAuthInstance().signOut();
        }

        function listFiles() {
            const contentDiv = document.getElementById('content');
            gapi.client.drive.files.list({
                'q': "'16krYsVMK38hKvUY1XjC8P3_c5ubauFCI' in parents and mimeType contains 'image/'",
                'pageSize': 10,
                'fields': "nextPageToken, files(id, name)"
            }).then(function(response) {
                const files = response.result.files;
                if (files && files.length > 0) {
                    contentDiv.innerHTML = '<h2>Files:</h2><ul>' + files.map(file => `<li>${file.name} (${file.id})</li>`).join('') + '</ul>';
                } else {
                    contentDiv.innerHTML = 'No files found in the specified folder.';
                }
            }, function(error) {
                console.error('Error loading Drive files', error);
                contentDiv.innerHTML = 'Error loading files.';
            });
        }
    </script>
</body>
</html>
